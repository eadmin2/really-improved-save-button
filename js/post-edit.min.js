window.FastWebCreations=window.FastWebCreations||{},window.FastWebCreations.SaveAndThen=window.FastWebCreations.SaveAndThen||{},function(t){var n=window.FastWebCreations.SaveAndThen;t(function(){var i=n.config,o=t("#post");i&&o.length&&new n.PostEditForm(o,i)}),n.PostEditForm=function(t,i){if(i.actions&&0!==i.actions.length){this.$form=t,this.config=i,this.action=null;var o=this.getDefaultAction();this.$actionInput=this.createActionInput(),this.$originalPublishButton=this.getOriginalPublishButton(),this.newPublishButtonSet=new n.PublishButtonSet(this),this.setupForm(),this.setupOriginalPublishButton(),this.newPublishButtonSet.setAction(o),this.insertNewPublishButtonSet()}},n.PostEditForm.prototype={getOriginalPublishButton:function(){return this.$form.find("#publish")},createActionInput:function(){return t('<input type="hidden" name="'+n.HTTP_PARAM_ACTION+'" />')},setupForm:function(){this.$form.prepend(this.$actionInput)},setupOriginalPublishButton:function(){this.config.setAsDefault&&this.$originalPublishButton.removeClass("button-primary").removeAttr("accesskey")},insertNewPublishButtonSet:function(){var t=this.newPublishButtonSet.$container;this.config.setAsDefault?this.$originalPublishButton.after(t):this.$originalPublishButton.before(t),this.$originalPublishButton.hide()},setAction:function(t){this.action=t,this.$actionInput.val(t.id)},getAction:function(){return this.action},submit:function(){this.setAction(this.newPublishButtonSet.getAction());var n=t.Event("fwc-sat:submit");this.$form.trigger(n,this),n.isDefaultPrevented()||(this.$form.data("fwc-sat-button-submitted",!0),this.getOriginalPublishButton().click())},getDefaultAction:function(){var n,i=this.config.defaultActionId,o=null;return t.each(this.config.actions,function(t,i){if(i.enabled)return n=i,!1}),i?((o=this.getActionFromId(i))&&o.enabled||(o=n),o):n},getActionFromId:function(n){var i=null;return t.each(this.config.actions,function(t,o){if(o.id===n)return i=o,!1}),i}},n.PublishButtonSet=function(t){this.postEditForm=t,this.config=this.postEditForm.config,this.action=null,this.$mainButton=this.createMainButton(),this.$dropdownButton=this.createDropdownButton(),this.$dropdownMenu=this.createDropdownMenu(),this.$container=this.createContainer(),this.setupDocumentClickListener(),this.setupMainButtonListeners(),this.setupDropdownButtonListeners(),this.setupDropdownMenuListeners()},n.PublishButtonSet.prototype={createMainButton:function(){var n=t('<button type="button"/>');return n.attr("class","button button-large fwc-sat-main-button"),this.config.setAsDefault&&n.addClass("button-primary"),n},createDropdownButton:function(){var n=t('<input type="button" value="â–¼" />');return n.attr("class",this.$mainButton.attr("class")),n.removeClass("fwc-sat-main-button").addClass("fwc-sat-dropdown-button"),n},createDropdownMenu:function(){var n=t('<ul class="fwc-sat-dropdown-menu"></ul>'),i=this;return t.each(this.config.actions,function(o,s){var e=t('<li data-fwc-sat-value="'+s.id+'">'+i.generateButtonLabel(s.buttonLabelPattern)+"</li>");s.title&&e.attr("title",s.title),s.enabled?e.data("fwcSatActionData",s):e.addClass("disabled"),n.append(e)}),n},createContainer:function(){var n=t('<span class="fwc-sat-container"></span>');return n.append(this.$mainButton),this.config.actions.length>1&&n.addClass("fwc-sat-with-dropdown").append(this.$dropdownButton).append(this.$dropdownMenu),this.config.setAsDefault&&n.addClass("fwc-sat-set-as-default"),n},setupDocumentClickListener:function(){var n=this;t(document).click(function(){n.menuShown()&&n.hideMenu()})},setupMainButtonListeners:function(){var n=this;this.$mainButton.click(function(){t(this).hasClass("disabled")||n.postEditForm.submit()})},setupDropdownButtonListeners:function(){var t=this;this.$dropdownButton.click(function(n){t.menuShown()||(t.showMenu(),n.stopPropagation())})},setupDropdownMenuListeners:function(){var n=this;this.$dropdownMenu.on("click","li",function(){t(this).hasClass("disabled")||(n.setAction(t(this).data("fwcSatActionData")),n.$mainButton.click())})},menuShown:function(){return this.$container.hasClass("fwc-sat-dropdown-menu-shown")},showMenu:function(){this.$container.addClass("fwc-sat-dropdown-menu-shown")},hideMenu:function(){this.$container.removeClass("fwc-sat-dropdown-menu-shown")},setAction:function(t){this.action=t,this.updateLabels()},getAction:function(){return this.action},updateLabels:function(){var n=this;this.$mainButton.html(this.generateButtonLabel(this.action.buttonLabelPattern)),this.$mainButton.attr("title",this.action.title?this.action.title:""),t.each(this.config.actions,function(t,i){n.$dropdownMenu.find('[data-fwc-sat-value="'+i.id+'"]').html(n.generateButtonLabel(i.buttonLabelPattern))})},generateButtonLabel:function(t){return t.replace("%s",this.postEditForm.$originalPublishButton.val())}}}(jQuery);